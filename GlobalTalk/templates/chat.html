<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat</title>
	<style>
		.main-div {
			display: flex;
			flex-direction: row;
			justify-content: space-between;
			align-items: stretch;
			height: 500px; /* Set height as needed */		
		}
		
		.main-sub-div {
			height: 100%; /* Sub-div height same as mother-div */
			box-sizing: border-box; /* Include padding in width */
			border: 1px solid black; /* Just for visualization */
		}
		/* Styles for the toolbar */
		.main-left-vertical-toolbar {
			width: 60px;
			background-color: #f0f0f0;
			display: flex;
			flex-direction: column;
			align-items: center;
		}
		
		.main-sub-friend-div {
			width: 25%;
			display: flex;
			flex-direction: column;
			padding: 5px;
		}
		.main-sub-chat-div {
			width: 75%;
			display: flex;
			flex-direction: column;
			padding: 5px;
		}
		
		.edit-box {
			flex: 1;
			padding: 5px;
			margin-right: 10px;
		}
		.output-box {
			padding: 10px;
			border: 1px solid #ccc;
			height: 100%; /* Adjust height as needed */
		}	
		.send-button {
			padding: 5px 10px;
			background-color: #007bff;
			color: #fff;
			border: none;
			cursor: pointer;
		}	
		/* CSS for positioning the hyperlinks */
		.top-right {
			position: absolute;
			top: 10px;
			right: 10px;
		}
		.bottom-container {
			display: flex;
			justify-content: space-between;
			align-items: center;
			margin-top: 10px;
		}
		label {
			display: inline-block;
			margin-right: 10px;
			font-weight: bold;
			width: 100%;
		}
		.friends {
			display: inline-block;
			margin-right: 10px;
			width: 100%;
			height: 100%; /* Set height as needed */
		}	
		.settings {
			display: inline-block;
			margin-right: 10px;
			width: 100%;
			height: 100%; /* Set height as needed */
		}	
		.blank-line {
			margin-bottom: 20px; /* Adjust as needed */
		}	
		.toolbar {
			background-color: #f0f0f0;
			width: 60px;
			position: fixed;
			top: 0;
			left: 0;
			bottom: 0;
			display: flex;
			flex-direction: column;
			align-items: center;
			padding-top: 20px;
		}
		.toolbar-icon {
			font-size: 24px;
			color: #555;
			margin-bottom: 10px;
			cursor: pointer;
		}	
		.popup-menu {
			display: none;
			position: absolute;
			background-color: #f9f9f9;
			min-width: 160px;
			box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
			z-index: 1;
		}

		.popup-menu a {
			color: black;
			padding: 12px 16px;
			text-decoration: none;
			display: block;
		}

		.popup-menu a:hover {
			background-color: #ddd;
		}

		.image-container {
			position: relative;
			display: inline-block;
		}

		.image-container .popup-menu {
			top: 0px; /* adjust this value to position the menu */
			left: 50px; /* adjust this value to position the menu */
		}

		.image-container:hover .popup-menu {
			display: block;
		}
		
		.friend-avatar-container {
			display: flex;
			align-items: flex-start;
		}

		.friend-avatar-container img {
			max-width: 100px; /* Adjust the size as needed */
			margin-right: 10px; /* Space between image and label */
		}

		.friend-avatar-container .label {
			display: flex;
			align-items: flex-start;
			justify-content: flex-start;
		}
    </style>
	
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <div class="main-div">
		<div class="main-sub-div main-left-vertical-toolbar">
			<div class="image-container">
			  <img src='/image' alt="Click Me" width="50" height="50">
			  <div class="popup-menu">
				<a href="/change_image_link">Change image</a>
				<a href="/change_language_link">Change language</a>
				<a href="/change_budget_link">Change Budget</a>
				<a href="/signin_link">Sign out</a>
			  </div>
			</div>
		    <a href="/add_friend_link">
				<img src="/icon/2" alt="Icon 2" width="50" height="50">
			</a>
			<img src="/icon/2" alt="Icon 2" width="50" height="50">
			<img src="/icon/3" alt="Icon 3" width="50" height="50">
			<img src="/icon/4" alt="Icon 4" width="50" height="50">
		</div>	
		
		<div class="main-sub-div main-sub-friend-div">
			<label>Friends:</label>
			<select class="friends" id="friend_list">
				{% for key, value in friends.items(): %}
				    {% if key == friend_selected %}
						<option value={{ key }} selected>{{ value }}</option>
					{% else %}
						<option value={{ key }}>{{ value }}</option>
					{% endif %}
				{% endfor %}
			</select>
		</div>

		<div class="main-sub-div main-sub-chat-div">
			<div class="friend-avatar-container">
				<img src='/image1' id='friend_picture' alt="Click Me" width="50" height="50">
				<div class="label">
					<label id="friend_name" for="output-box"><strong>No name:</strong></label>
				</div>
			</div>
			<div class="output-box" id="output-box">
				<!-- Output box content goes here -->
			</div>
			<div class="bottom-container">
				<input type="text" class="edit-box" id="message-input" placeholder="Type your message...">
				<button class="send-button" id="send-button">Send</button>
			</div>
		</div>
    </div>
    <script>
        document.getElementById('friend_list').addEventListener('click', async function(event) {
            event.preventDefault();

            var selectedOption = document.getElementById("friend_list").value;

            const response1 = await fetch('/select_friend', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ friend: selectedOption })
            });

            if (response1.ok) {
                const blob = await response1.blob();
                const url = URL.createObjectURL(blob);

                document.getElementById('friend_picture').src = url;
            } else {
                document.getElementById('responseText').textContent = 'Error: Unable to get response from server';
            }

            const response2 = await fetch('/select_friend_name', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ friend: selectedOption })
            });

            if (response2.ok) {
                const result = await response2.json();
				document.getElementById('friend_name').textContent = result.friend_name;
            } else {
                document.getElementById('responseText').textContent = 'Error: Unable to get response from server';
            }			
        });	
    </script>	
</body>
</html>
